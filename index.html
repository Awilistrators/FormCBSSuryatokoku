<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulir Pendaftaran CARNIVAL BIG SALE SURYATOKOKU VOL.1</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      /* Georgia Peach palette */
      --bg1:#FFF2EE; /* very light peach */
      --bg2:#FFF8F6; /* lighter */
      --accent:#F6A192; /* peach */
      --accent2:#FFD8C2; /* soft cream */
      --card:#ffffff;
      --glass: rgba(255,255,255,0.7);
      font-family: 'Montserrat', sans-serif;
    }
    html,body{height:100%;margin:0}
    body{
      background: radial-gradient(circle at 10% 10%, rgba(255,255,255,0.6), transparent 5%),
                  linear-gradient(120deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;padding:24px;
    }
    .page{width:100%;max-width:920px}
    .hero{
      display:flex;gap:20px;align-items:center;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.7));
      border-radius:16px;padding:18px;box-shadow:0 8px 26px rgba(0,0,0,0.06);position:relative;overflow:hidden
    }
    /* carnival decorations */
    .bunting{position:absolute;left:-30px;top:-30px;width:300px;transform:rotate(-10deg);opacity:0.95}
    .hero-left{flex:1;min-width:240px}
    .title{font-size:18px;font-weight:800;letter-spacing:0.02em;margin:0;color:#222}
    .subtitle{font-size:13px;margin-top:6px;color:#444}
    .card{flex:2;background:var(--card);border-radius:12px;padding:16px}
    label{display:block;font-size:13px;margin-bottom:6px;color:#333}
    input[type=text], input[type=date], input[type=email], input[type=tel], select, textarea{
      width:100%;padding:10px;border-radius:8px;border:1px solid #f0e6e3;background:transparent;margin-bottom:12px;font-size:14px
    }
    .row{display:flex;gap:12px}
    .col{flex:1}
    button{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;padding:12px 16px;border-radius:10px;color:#fff;font-weight:700;cursor:pointer}
    .option-btn{display:inline-block;padding:10px 14px;border-radius:10px;margin-right:8px;cursor:pointer;border:1px solid rgba(0,0,0,0.06);background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;font-weight:700}
    .muted{font-size:12px;color:#666}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:16px}
    .modal{background:white;border-radius:12px;max-width:700px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,0.2)}
    .modal h3{margin-top:0}
    .hidden{display:none}
    .qr-wrap{display:flex;gap:20px;align-items:center}
    .qr{width:180px;height:180px;background:#fff;padding:8px;border-radius:10px}
    .note{font-size:13px;color:#444}
    /* responsive */
    @media (max-width:700px){.hero{flex-direction:column}.row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="page">
    <div class="hero">
      <svg class="bunting" viewBox="0 0 200 80" width="320" height="160" aria-hidden>
        <g>
          <path d="M0 20 C40 0 160 0 200 20 L200 0 L0 0 Z" fill="#ffe7e2" opacity="0.95"/>
          <g transform="translate(12,8)">
            <polygon points="0,0 18,0 9,16" fill="#F6A192"/>
            <polygon points="26,0 44,0 35,16" fill="#FFD8C2"/>
            <polygon points="52,0 70,0 61,16" fill="#F7D0C6"/>
            <polygon points="78,0 96,0 87,16" fill="#F6B4A7"/>
            <polygon points="104,0 122,0 113,16" fill="#F6A192"/>
          </g>
        </g>
      </svg>

      <div class="hero-left">
        <h1 class="title">Formulir Pendaftaran</h1>
        <div class="subtitle">CARNIVAL BIG SALE SURYATOKOKU VOL.1 ‚Äî Akhir Tahun 2025</div>
        <p class="muted">Daftar sekarang untuk kesempatan hadir & mengikuti promo eksklusif.</p>
      </div>

      <div class="card">
        <form id="mainForm">
          <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:6px">
            <strong style="font-size:14px">Isi data pendaftaran (wajib)</strong>
            <small class="muted">Semua field wajib diisi</small>
          </div>

          <label>Nama Lengkap
            <input type="text" id="nama" name="nama" required />
          </label>

          <div class="row">
            <div class="col">
              <label>Gender
                <select id="gender" name="gender" required>
                  <option value="">Pilih...</option>
                  <option value="Laki-laki">Laki-laki</option>
                  <option value="Perempuan">Perempuan</option>
                  <option value="Lainnya">Lainnya</option>
                </select>
              </label>
            </div>
            <div class="col">
              <label>Tanggal Lahir
                <input type="date" id="tgllahir" name="tgllahir" required />
              </label>
            </div>
          </div>

          <label>Nomor Whatsapp
            <input type="tel" id="whatsapp" name="whatsapp" pattern="\+?[0-9\s\-]{6,20}" placeholder="Contoh: +6281234567890" required />
          </label>

          <label>Alamat email
            <input type="email" id="email" name="email" required />
          </label>

          <label>Alamat Lengkap
            <textarea id="alamat" name="alamat" rows="3" required></textarea>
          </label>

          <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:6px">
            <button type="button" id="submitBtn">Kirim Pendaftaran</button>
          </div>
        </form>

        <div id="result" class="hidden" style="margin-top:12px"></div>
      </div>
    </div>

    <!-- Modal: only two buttons as requested -->
    <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true">
      <div class="modal">
        <h3>Apakah kamu ingin bergabung ke komunitas @Suryafluencers (TIDAK WAJIB)</h3>
        <p style="white-space:pre-line">SELAMAT DATANG CREATOR @Suryafluencers ü§≥üèª\n@Suryafluencers adalah program Creator & Reviewer Suryatokoku yang ditujukan bagi Content Creator yang ingin berkolaborasi dengan melalui pembuatan konten, event/campaign dan review produk dengan kesempatan mendapatkan produk gratis.\n\nSebagai bagian dari komunitas ini, Creator berkesempatan untuk:\n- Akses Early Information terkait event/campaign yang diadakan di Suryatokoku\n- Mendapatkan Extra Point Member Suryatokoku\n- Special Goodie Bag\n- Sampel produk gratis untuk di review\n- Membangun Personal Branding sebagai KOL di Suryatokoku\n@Suryafluencers bukan hanya tentang review, tetapi tentang kolaborasi jangka panjang, pertumbuhan Creator, dan menciptakan konten yang berdampak.</p>

        <div style="margin-top:12px;text-align:left">
          <button id="joinYes" class="option-btn">Ya, ikut</button>
          <button id="joinNo" class="option-btn">Tidak Tertarik, Kirim Pendaftaran Sekarang</button>
        </div>
      </div>
    </div>

    <!-- QR + confirmation -->
    <div id="afterArea" class="hidden" style="margin-top:18px;background:rgba(255,255,255,0.95);padding:14px;border-radius:12px">
      <h3 style="margin:0 0 8px 0">Pendaftaran Sukses</h3>
      <div class="qr-wrap">
        <div>
          <div class="note">Tunjukkan QR ini saat verifikasi / masuk acara. QR berisi: Nama | Nomor Whatsapp</div>
          <div id="qrcode" class="qr" aria-hidden></div>
        </div>
        <div>
          <p id="confirmText" class="note"></p>
          <p class="muted">Data pendaftaran telah dikirim ke Google Sheet.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- QR library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    // --- CONFIG: ganti WEBHOOK_URL dengan URL Web App Google Apps Script Anda ---
    const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbzaqH2LkENM0KfJqVxaYpl7XY8fXMS7qbSmi_twzjlcg40d1kLRIKazHCQdPWEp1OgWMw/exec";

    const submitBtn = document.getElementById('submitBtn');
    const modal = document.getElementById('modal');
    const joinYes = document.getElementById('joinYes');
    const joinNo = document.getElementById('joinNo');
    const afterArea = document.getElementById('afterArea');
    const qrcodeContainer = document.getElementById('qrcode');
    const confirmText = document.getElementById('confirmText');

    let currentFormData = null;

    submitBtn.addEventListener('click', ()=>{
      const form = document.getElementById('mainForm');
      if(!form.reportValidity()) return;
      // collect base data
      currentFormData = collectBaseForm();
      // show modal
      modal.style.display='flex';
    });

    joinYes.addEventListener('click', async ()=>{
      currentFormData.joinSuryafluencers = 'Ya';
      modal.style.display='none';
      await sendAndShowResult(currentFormData);
    });

    joinNo.addEventListener('click', async ()=>{
      currentFormData.joinSuryafluencers = 'Tidak';
      modal.style.display='none';
      await sendAndShowResult(currentFormData);
    });

    function collectBaseForm(){
      return {
        nama: document.getElementById('nama').value.trim(),
        gender: document.getElementById('gender').value,
        tgllahir: document.getElementById('tgllahir').value,
        whatsapp: document.getElementById('whatsapp').value.trim(),
        email: document.getElementById('email').value.trim(),
        alamat: document.getElementById('alamat').value.trim(),
      };
    }

    async function sendAndShowResult(data){
      // generate QR text and show UI as soon as possible
      const qrText = (data.nama || '') + ' | ' + (data.whatsapp || '');
      generateQR(qrText);
      confirmText.textContent = `Nama: ${data.nama}\nWA: ${data.whatsapp}`;
      afterArea.classList.remove('hidden');

      // try to send to Google Apps Script (save to Google Sheet)
      if(WEBHOOK_URL && WEBHOOK_URL.indexOf('script.google.com')!==-1){
        try{
          const resp = await fetch(WEBHOOK_URL,{
            method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)
          });
          if(!resp.ok){
            console.error('Response not OK',resp.status);
            alert('Peringatan: Gagal menyimpan data ke Google Sheet. Silakan periksa konfigurasi Web App.');
          }
        }catch(err){
          console.error('Gagal kirim ke Google Apps Script',err);
          alert('Peringatan: Gagal menyimpan data ke Google Sheet. Silakan periksa koneksi / izin Web App.');
        }
      }else{
        alert('Web App Google belum dikonfigurasi dengan benar. Data tidak tersimpan di Sheet.');
      }

      // automatically download the QR image
      autoDownloadQR(data.nama, data.whatsapp);
    }

    function generateQR(text){
      qrcodeContainer.innerHTML='';
      new QRCode(qrcodeContainer, {text:text, width:180, height:180});
    }

    function autoDownloadQR(name, wa){
      // wait a tick until QR image is rendered
      setTimeout(()=>{
        const img = qrcodeContainer.querySelector('img');
        if(img && img.src){
          const safeName = (name||'user').replace(/[^a-z0-9]/gi,'_');
          const safeWA = (wa||'wa').replace(/[^a-z0-9\+]/gi,'');
          const a = document.createElement('a');
          a.href = img.src;
          a.download = `QR_${safeName}_${safeWA}.png`;
          document.body.appendChild(a);
          a.click();
          a.remove();
        }else{
          // fallback: try to use canvas (some browsers render as canvas)
          const canvas = qrcodeContainer.querySelector('canvas');
          if(canvas){
            const url = canvas.toDataURL('image/png');
            const a = document.createElement('a'); a.href = url; a.download = `QR_${(name||'user')}_${(wa||'wa')}.png`; document.body.appendChild(a); a.click(); a.remove();
          }
        }
      },300);
    }
  </script>

</body>
</html>
